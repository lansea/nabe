<!DOCTYPE html>    <html>  <head>    <title>routes.js</title>    <meta http-equiv="content-type" content="text/html; charset=UTF-8">    <link rel="stylesheet" media="all" href="docco.css" />  </head>  <body>    <div id="container">      <div id="background"></div>              <div id="jump_to">          Jump To &hellip;          <div id="jump_wrapper">            <div id="jump_page">                                              <a class="source" href="config.html">                  config.html                </a>                                              <a class="source" href="ext/github.html">                  ext/github.html                </a>                                              <a class="source" href="ext/json.html">                  ext/json.html                </a>                                              <a class="source" href="ext/pages.html">                  ext/pages.html                </a>                                              <a class="source" href="model/posts.html">                  model/posts.html                </a>                                              <a class="source" href="nabe.html">                  nabe.html                </a>                                              <a class="source" href="renderer.html">                  renderer.html                </a>                                              <a class="source" href="routes.html">                  routes.html                </a>                                              <a class="source" href="util.html">                  util.html                </a>                          </div>          </div>        </div>            <table cellpadding="0" cellspacing="0">        <thead>          <tr>            <th class="docs">              <h1>                routes.js              </h1>            </th>            <th class="code">            </th>          </tr>        </thead>        <tbody>                                  <tr id="section-1">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-1">&#182;</a>                </div>                <p>This file is the main router; it is loaded by the main application bootstrap file. </p>

<p>Generally, this file should be used only for defining routes.</p>

<p>Actual functionality should be placed in other files that export 
actions to trigger on routes defined here.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./config'</span><span class="pun">),</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-2">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-2">&#182;</a>                </div>                <p><strong>renderer module, more on this <a href="renderer.html">here</a></strong></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">renderer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./renderer'</span><span class="pun">),</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-3">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-3">&#182;</a>                </div>                <p>this is failsafe, designed to be triggered when an undefined renderer is passed in <code>addRoute</code>.
Also useful to see routes triggered and parameters available.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">defaultHandler </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> defaultHandler</span><span class="pun">(</span><span class="pln">route</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">req</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">next</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Matching route '</span><span class="pun">,</span><span class="pln"> route</span><span class="pun">,</span><span class="pln"> </span><span class="str">' for '</span><span class="pun">,</span><span class="pln"> req</span><span class="pun">.</span><span class="pln">url</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'params: '</span><span class="pun">,</span><span class="pln"> req</span><span class="pun">.</span><span class="kwd">params</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">next</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">};</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-4">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-4">&#182;</a>                </div>                <p>internal helper to force context on controllers' actions.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">proxy </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> proxy</span><span class="pun">(</span><span class="pln">fn</span><span class="pun">,</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> proxy</span><span class="pun">(</span><span class="pln">req</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">next</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> fn</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> arguments</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">};</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-5">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-5">&#182;</a>                </div>                <h2>Router</h2>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-6">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-6">&#182;</a>                </div>                <p>Using <a href="http://senchalabs.github.com/connect/middleware-router.html">connect.router</a></p>

<blockquote>
  <p>Provides Sinatra and Express-like routing capabilities.</p>
</blockquote>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-7">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-7">&#182;</a>                </div>                <p>this file creates and expose the router layer to pass in the connect server.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="kwd">var</span><span class="pln"> router </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> router</span><span class="pun">(</span><span class="pln">app</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-8">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-8">&#182;</a>                </div>                <p>Internal helper that set up a new <code>GET</code> routes </p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> addRoute </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">route</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; r </span><span class="pun">=</span><span class="pln"> r </span><span class="pun">||</span><span class="pln"> defaultHandler</span><span class="pun">(</span><span class="pln">route</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; app</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">route</span><span class="pun">,</span><span class="pln"> proxy</span><span class="pun">(</span><span class="pln">r</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">};</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-9">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-9">&#182;</a>                </div>                <h3>index</h3>

<p>triggered on <code>/</code>, this is the main action. It displays a list of posts
sorted by most recent ones.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; addRoute</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">index</span><span class="pun">);</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-10">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-10">&#182;</a>                </div>                <h3>feed.xml</h3>

<p>triggered on <code>/feed.xml</code>. It displays a list of posts
sorted by most recent ones and rendered using <code>feed.xml</code> template
to provide a basic rss feed.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; addRoute</span><span class="pun">(</span><span class="str">'/feed.xml'</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">feed</span><span class="pun">);</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-11">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-11">&#182;</a>                </div>                <h3>tag</h3>

<p>triggered on <code>/tag/tag-name</code>. It displays a list of posts
sorted by most recent ones and filtered depending on the requested
tag (tags are defined on top of each article files using <code>Categories</code> property).</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; addRoute</span><span class="pun">(</span><span class="str">'/tag/:tag'</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">tag</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-12">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-12">&#182;</a>                </div>                <h3>category</h3>

<p>triggered on <code>/category/category-name</code>. It displays a list of posts
sorted by most recent ones and filtered depending on the requested category.
The list of articles in <code>/folder/subfolder/</code> can be accessed with 
<code>/category/folder/subfolder/</code>
folders in articles one can be seen as a way of providing simple hierarchical categories.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; addRoute</span><span class="pun">(</span><span class="str">'/category/:category'</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">category</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-13">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-13">&#182;</a>                </div>                <h3>revision</h3>

<p>revision action, called on <code>e3e43764c7854f5ce4c16d527ec6244a3c2a0f7d/article-name</code>
display content of article-name.markdown from git history. It basically
enables server to read files out of a git repository as if they were local files.
This is possible thanks to <a href="https://github.com/creationix/node-git/">node-git</a>, a thin
wrapper around the command-line <code>git</code> command for use inside node applications.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; addRoute</span><span class="pun">(</span><span class="str">/\/([a-f0-9]{40})\/(.+)\/?/</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">revision</span><span class="pun">);</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-14">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-14">&#182;</a>                </div>                <h3>article</h3>

<p>article action, called on <code>/article/article-name</code> or <code>/article/folder/or/subfolder/article-name</code>
display an article content along meta-data informations and git revisions.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; addRoute</span><span class="pun">(</span><span class="str">/\/article\/(.+)\/?/</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">article</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-15">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-15">&#182;</a>                </div>                <h3><code>article/</code></h3>

<p>this is failsafe, displays exactly the same thing than index route.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; addRoute</span><span class="pun">(</span><span class="str">'/article'</span><span class="pun">,</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">index</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-16">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-16">&#182;</a>                </div>                <h3>Addition to the static provider</h3>

<p>this must be the last route, it's coming directly from
<a href="https://github.com/paulirish/html5-boilerplate-server-configs/blob/master/node.js">h5b-server-config for node</a></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; app</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'*'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">req</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">next</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> reqPath </span><span class="pun">=</span><span class="pln"> req</span><span class="pun">.</span><span class="pln">url</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; userAgent </span><span class="pun">=</span><span class="pln"> req</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">[</span><span class="str">'user-agent'</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; reqHost </span><span class="pun">=</span><span class="pln"> req</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">.</span><span class="pln">host</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">userAgent </span><span class="pun">&amp;&amp;</span><span class="pln"> userAgent</span><span class="pun">.</span><span class="pln">indexOf</span><span class="pun">(</span><span class="str">'MSIE'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> reqPath</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/\.html$/</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> reqPath</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/\.htm$/</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-17">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-17">&#182;</a>                </div>                <p>use this header for html files, or add it as a meta tag
to save header bytes serve it only to IE</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res</span><span class="pun">.</span><span class="pln">setHeader</span><span class="pun">(</span><span class="str">'X-UA-Compatible'</span><span class="pun">,</span><span class="pln"> </span><span class="str">"IE=Edge,chrome=1"</span><span class="pun">);</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-18">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-18">&#182;</a>                </div>                <p>protect .files</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reqPath</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/(^|\/)\./</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(</span><span class="str">"Not allowed"</span><span class="pun">);</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-19">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-19">&#182;</a>                </div>                <p>allow cross domain (for your subdomains)
disallow other domains.
you can get really specific by adding the file
type extensions you want to allow to the if statement</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reqHost </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">reqHost</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="pln">config</span><span class="pun">.</span><span class="pln">hostAddress</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(</span><span class="str">"Cross-domain is not allowed"</span><span class="pun">);</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">next</span><span class="pun">();</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-20">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-20">&#182;</a>                </div>                <p>let the static server do the rest</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                  </tbody>      </table>    </div>  </body>  </html>