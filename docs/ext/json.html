<!DOCTYPE html>    <html>  <head>    <title>json.js</title>    <meta http-equiv="content-type" content="text/html; charset=UTF-8">    <link rel="stylesheet" media="all" href="../docco.css" />  </head>  <body>    <div id="container">      <div id="background"></div>              <div id="jump_to">          Jump To &hellip;          <div id="jump_wrapper">            <div id="jump_page">                                              <a class="source" href="../config.html">                  config.html                </a>                                              <a class="source" href="../ext/github.html">                  ext/github.html                </a>                                              <a class="source" href="../ext/json.html">                  ext/json.html                </a>                                              <a class="source" href="../ext/pages.html">                  ext/pages.html                </a>                                              <a class="source" href="../model/posts.html">                  model/posts.html                </a>                                              <a class="source" href="../nabe.html">                  nabe.html                </a>                                              <a class="source" href="../renderer.html">                  renderer.html                </a>                                              <a class="source" href="../routes.html">                  routes.html                </a>                                              <a class="source" href="../util.html">                  util.html                </a>                          </div>          </div>        </div>            <table cellpadding="0" cellspacing="0">        <thead>          <tr>            <th class="docs">              <h1>                json.js              </h1>            </th>            <th class="code">            </th>          </tr>        </thead>        <tbody>                                  <tr id="section-1">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-1">&#182;</a>                </div>                              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> http </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'http'</span><span class="pun">),</span><span class="pln"><br />config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../config'</span><span class="pun">),</span><span class="pln"><br />renderer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../renderer'</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="com">/**<br />* Define a custom renderJSON method on ServerResponse.<br />*<br />* Usage:<br />* &nbsp;res.renderJSON({foo: 'bar'})<br />*/</span><span class="pln"><br /></span><span class="typ">Object</span><span class="pun">.</span><span class="pln">defineProperty</span><span class="pun">(</span><span class="pln">http</span><span class="pun">.</span><span class="typ">ServerResponse</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">,</span><span class="pln"> </span><span class="str">'renderJSON'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; value</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; data </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="pln"><br />&nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">writeHead</span><span class="pun">(</span><span class="lit">200</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="str">'Content-Type'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'application/json'</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="str">'Content-Length'</span><span class="pun">:</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">length<br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /><br /></span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> json</span><span class="pun">(</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; <br />&nbsp; console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'init json layer &gt; '</span><span class="pun">,</span><span class="pln"> o</span><span class="pun">);</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-2">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-2">&#182;</a>                </div>                <p>the renderer is an instance of events.EventEmitter
that any module can require and provide/subscribe to custom events</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; renderer</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'nabe.render'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">res</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">){</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">headers </span><span class="pun">?</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">.</span><span class="pln">accept </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="str">/application\/json/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">a</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">delete</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; res</span><span class="pun">.</span><span class="pln">renderJSON</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-3">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-3">&#182;</a>                </div>                <p>or you can edit and alter the data object then use to render template files</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; data</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">=</span><span class="pln"> </span><span class="str">"data added on nabe.render event"</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; <br />&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> json</span><span class="pun">(</span><span class="pln">req</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">next</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-4">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-4">&#182;</a>                </div>                <p>trigger on each routes not handled by the main blog layer</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> req</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">a </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="str">/application\/json/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">a</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> res</span><span class="pun">.</span><span class="pln">renderJSON</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; description</span><span class="pun">:</span><span class="pln"> </span><span class="str">'a simple example of a pluggable connect layer'</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">next</span><span class="pun">();</span><span class="pln"><br />&nbsp; </span><span class="pun">};</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                  </tbody>      </table>    </div>  </body>  </html>